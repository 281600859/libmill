<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mill</title>
  <style>
  body {font-family:sans-serif;} 
  #toplist {
    padding-left: 0px;
  }
  #toplist li {
    display: inline;
    list-style-type: none;
    padding-right: 15px;
  }
  a {color:#000000;}
  </style>
</head>
<body>
<div style="width:50em">

<h1>Mill - C language with coroutines</h1>

<b>
<ul id='toplist'>
<li><a href="index.html">Home</a></li>
<li><a href="download.html">Download</a></li>
<li><a href="documentation.html">Documentation</a></li>
<li><a href="development.html">Development</a></li>
<li><a href="community.html">Community</a></li>
</ul>
</b>

<h2>Development</h2>

<h3>Source code</h3>

<p>Source code is hosted on GitHub:</p>
<p><a href="https://github.com/sustrik/mill">https://github.com/sustrik/mill</a></p>

<p>Source code of this website is located in gh-pages branch:</p>
<p><a href="https://github.com/sustrik/mill/tree/gh-pages">https://github.com/sustrik/mill/tree/gh-pages</a></p>

<h3>Build</h3>

<p>If developing mill (as opposed to just using it) build it the following way.</p>

<p>First, install these prerequisites:</p>

<ul>
<li>Install Ruby
<li>Install libuv from here: <a href="https://github.com/joyent/libuv">https://github.com/joyent/libuv</a>
<li>Install ribosome from here: <a href="https://github.com/sustrik/ribosome">https://github.com/sustrik/ribosome</a>
<li>Install Ragel from here: <a href="http://www.complang.org/ragel/">http://www.complang.org/ragel/</a>
</ul>

<p>Then execute the following sequence commands:</p>

<pre>
    $ ./autogen.sh
    $ ./configure --enable-gen
    $ make
    $ sudo make install
</pre>

<h3>Understanding the toolchain</h3>

<p>The files in the project are generated in the following way. Grey boxes
represent target files (ones delivered to the end user):</p>

<img src="toolchain.png">

<p><tt>clexer.lr'</tt> is a file describing C tokens that is processed by Ragel
to create C tokeniser. Use -R option when running Ragel to create Ruby version
of the tokeniser. Note that there is no parser (except for a very simple one
that does nothing but match pairs of braces -- also implemented in
<tt>clexer.rl</tt>). Being a simple tool, Mill does not attemp to do syntactic
ananlysis of the source and relies fully on expanding lexical tokens.</p>

<p><tt>clexer.rb</tt> is thus the source code of the tokeniser. It is included
into <tt>mill.dna</tt> which means that an exact copy of the code appears in
<tt>mill</tt></p>

<p><tt>mill.dna</tt> is the source code of the Mill preprocessor. It's in
essence a Ruby code with some fancy syntax for code generation. It is processed
by ribosome (use <tt>--rna</tt> switch to avoid runtime dependency on ribosome)
to create <tt>mill</tt>.</p>

<p><tt>mill</tt> is the C preprocessor itself. It is a Ruby program, however,
for convenience's sake it has no <tt>.rb</tt> extension.</p>

<p><tt>stdmill.mh</tt> and <tt>stdmill.mc</tt> implement the core language
runtine along with the library of elementary coroutines (timers, socket
operations et c.) They have to be pre-processed by <tt>mill</tt> (use
<tt>--system</tt> switch to provide them with more flexibility) to yield actual
library source code.</p>

<p><tt>stdmill.h</tt> and <tt>stdmill.c</tt> are generated from
<tt>stdmill.mh</tt> and <tt>stdmill.mc</tt>. Along with <tt>mill.h</tt> and
<tt>mill.c</tt> they are the source code for Mill runtime library.</p>

<p><tt>libstdmill.so</tt> is Mill runtime library. It has to be installed
everywhere where Mill programs are being run. The library uses <tt>libuv.so</tt>
to interface with the operating system.</p>

<p>The part in the dotted box is done only by Mill developers
(<tt>--enable-gen</tt> option). Ordinary users perform just the last step of
the toolchain (generating the library from <tt>stdmill.h</tt> and
<tt>stdmill.c</tt>) when building the project.</p>

<h3>Bug tracker</h3>

<p>Use GitHub bug tracker to report problems with Mill:</p>
<p><a href="https://github.com/sustrik/mill/issues">https://github.com/sustrik/mill/issues</a></p>

<h3>Contributing</h3>

<p>To contribute to the project send your patch to the mailing list or,
alternatively, send a GitHub pull request. In either case you have to state that
your patch is submitted under MIT/X11 license, so that we can incorporate it
into the mainline codebase.</p>

<p>If you make a substantial contribution to a file, add your copyright to the
file header. Irrespective of whether you do so, your name will be added to the
AUTHORS file to indicate you own copyright to a part of the codebase.</p>

</div>
</body>
</html>
